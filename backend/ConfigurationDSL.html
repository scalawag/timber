<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Configuration DSL &middot; Timber
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="/public/css/custom.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <!-- <link rel="shortcut icon" href="/public/favicon.ico"> -->

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <div class="sidebar">
  <div class="container">
    <div class="sidebar-about">
      <h1>
        Timber
      </h1>
      <p class="lead"></p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/">Home</a>

      

      
      

      
        
        
          
            
              
                <a class="sidebar-nav-item" href="/Concepts">Concepts</a>
              
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
        
        <hr/>
      
        timber-api
        
          
            
          
        
          
            
          
        
          
            
              
                <a class="sidebar-nav-item" href="/api/GettingStarted">Getting Started</a>
              
            
          
        
          
            
          
        
          
            
              
                <a class="sidebar-nav-item" href="/api/Loggers">Loggers</a>
              
            
          
        
          
            
          
        
          
            
              
                <a class="sidebar-nav-item" href="/api/Messages">Messages</a>
              
            
          
        
          
            
          
        
          
            
              
                <a class="sidebar-nav-item" href="/api/Levels">Levels</a>
              
            
          
        
          
            
          
        
          
            
              
                <a class="sidebar-nav-item" href="/api/ThreadAttributes">Thread Attributes</a>
              
            
          
        
          
            
          
        
          
            
          
        
          
            
              
                <a class="sidebar-nav-item" href="/api/BestPractices">Best Practices</a>
              
            
          
        
          
            
              
                <a class="sidebar-nav-item" href="/api/AdvancedUsage">Advanced Usage</a>
              
            
          
        
          
        
        <hr/>
      
        timber-backend
        
          
            
          
        
          
            
              
                <a class="sidebar-nav-item" href="/backend/GettingStarted">Getting Started</a>
              
            
          
        
          
            
          
        
          
            
              
                <a class="sidebar-nav-item" href="/backend/Dispatchers">Dispatchers</a>
              
            
          
        
          
            
          
        
          
            
              
                <a class="sidebar-nav-item active" href="/backend/ConfigurationDSL">Configuration DSL</a>
              
            
          
        
          
            
          
        
          
            
              
                <a class="sidebar-nav-item" href="/backend/Conditions">Conditions</a>
              
            
          
        
          
            
          
        
          
            
              
                <a class="sidebar-nav-item" href="/backend/Entries">Entries</a>
              
            
          
        
          
            
          
        
          
            
              
                <a class="sidebar-nav-item" href="/backend/Formatters">Formatters</a>
              
            
          
        
          
            
              
                <a class="sidebar-nav-item" href="/backend/Receivers">Receivers</a>
              
            
          
        
          
            
          
        
          
            
          
        
          
        
        <hr/>
      

      <a class="sidebar-nav-item" href="https://github.com/scalawag/timber">View on GitHub</a>
<!--      <a class="sidebar-nav-item" href="https://github.com/scalawag/timber/archive/v0.6.0-SNAPSHOT.zip">Download</a> -->
      <span class="sidebar-nav-item">Currently v0.6.0-SNAPSHOT</span>
    </nav>

    <p>&copy; 2016</p>
  </div>
</div>


    <div class="content container">
      <div class="page">
  <h1 class="page-title">Configuration DSL</h1>
  <h2 id="concepts">Concepts</h2>

<p>A <code class="highlighter-rouge">Configuration</code> is used in timber to tell a <a href="Dispatchers">dispatcher</a> which <a href="Entries">entries</a> to route to which
<a href="Receivers">receivers</a>.  It takes the form of a
<a href="http://en.wikipedia.org/wiki/Directed_acyclic_graph">directed acyclic graph</a> (DAG).  At each vertex in the graph
lies either a <a href="Conditions">condition</a> or a receiver.</p>

<p>Condition vertices can have any number of outbound edges which each lead to either another condition vertex or a
receiver vertex. Receiver vertices are leaf nodes and cannot have outbound edges.</p>

<p>A configuration has a set of vertices called the <em>roots</em> where evaluation starts for each entry. To determine which
receivers will receive a particular entry, a dispatcher considers every path through the configuration DAG from a
root vertex to a receiver vertex. A path accepts the entry if and only if every condition along the path accepts
the entry.  A single rejecting condition prevents the receiver from receiving the entry (through this path, at
least). Conditions are evaluated in order from the root to the receiver, so placing more discriminating conditions
closer to the root results in better performance.  A path with no conditions (if a receiver vertex <em>is</em> a root)
automatically accepts all entries. If a path accepts an entry, its terminal receiver receives the entry.</p>

<p>Multiple paths can terminate at the same receiver.  This simply means that there are several sets of criteria which
may result in an entry being received by that receiver.  If more than one of these paths accept the entry, the
receiver still only receives the entry once.</p>

<p>At first, this may seem more complicated than it really is once you begin using the timber configuration DSL.</p>

<h2 id="examples">Examples</h2>

<p>The best way to learn the DSL is to look at some examples.  Here’s a simple graph that logs to stderr only entries
that have a level of <code class="highlighter-rouge">INFO</code> or higher.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">org.scalawag.timber.api.level.Level._</span>
<span class="k">import</span> <span class="nn">org.scalawag.timber.backend.dispatcher.configuration.dsl._</span>

<span class="o">(</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="nc">INFO</span> <span class="o">)</span> <span class="o">~&gt;</span> <span class="n">stderr</span>
</code></pre>
</div>

<p>Here’s a visualization of that graph.  Click on the thumbnail to get a larger version.</p>

<p><a href="graph/a.svg"><img src="graph/a.svg" alt="debug graph" height="150px" /></a></p>

<p>Here’s another that prints <em>anything</em> logged from the timber package but only <code class="highlighter-rouge">ERROR</code> messages otherwise.  It
demonstrates that, to achieve an “or”, you can wire up two conditions in parallel.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">org.scalawag.timber.api.level.Level._</span>
<span class="k">import</span> <span class="nn">org.scalawag.timber.backend.dispatcher.configuration.dsl._</span>

<span class="k">val</span> <span class="n">in</span> <span class="k">=</span> <span class="nc">Condition</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
<span class="n">in</span> <span class="o">~&gt;</span> <span class="o">(</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="nc">ERROR</span> <span class="o">)</span> <span class="o">~&gt;</span> <span class="n">stderr</span>
<span class="n">in</span> <span class="o">~&gt;</span> <span class="o">(</span> <span class="n">loggingClass</span> <span class="n">startsWith</span> <span class="s">"org.scalawag.timber"</span> <span class="o">)</span> <span class="o">~&gt;</span> <span class="n">stderr</span>
</code></pre>
</div>

<p><a href="graph/b.svg"><img src="graph/b.svg" alt="debug graph" height="150px" /></a></p>

<p>This also demonstrates the use of <code class="highlighter-rouge">Condition(Boolean)</code> to create a condition vertex that always either accepts
(for <code class="highlighter-rouge">true</code>) or rejects (for <code class="highlighter-rouge">false</code>) each entry, no matter what its content.  Sometimes, it’s useful to create
a condition vertex like this just to help in creating your graph.  I did this here so that I would have something
to attach multiple edges to.  It’s basically just an aggregation or distribution point.</p>

<p>You can also use logical operations on conditions, if you prefer.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">org.scalawag.timber.api.level.Level._</span>
<span class="k">import</span> <span class="nn">org.scalawag.timber.backend.dispatcher.configuration.dsl._</span>

<span class="o">(</span> <span class="o">(</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="nc">ERROR</span> <span class="o">)</span> <span class="o">||</span> <span class="o">(</span> <span class="n">loggingClass</span> <span class="n">startsWith</span> <span class="s">"org.scalawag.timber"</span> <span class="o">)</span> <span class="o">)</span> <span class="o">~&gt;</span> <span class="n">stderr</span>
</code></pre>
</div>

<p><a href="graph/c.svg"><img src="graph/c.svg" alt="debug graph" height="150px" /></a></p>

<p>Operator precedence rules may dictate a lot of parentheses.</p>

<p>To achieve “and”-like behavior, you can either wire up two conditions in series.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">org.scalawag.timber.api.level.Level._</span>
<span class="k">import</span> <span class="nn">org.scalawag.timber.backend.dispatcher.configuration.dsl._</span>

<span class="o">(</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="nc">ERROR</span> <span class="o">)</span> <span class="o">~&gt;</span> <span class="o">(</span> <span class="n">loggingClass</span> <span class="n">startsWith</span> <span class="s">"org.scalawag.timber"</span> <span class="o">)</span> <span class="o">~&gt;</span> <span class="n">stderr</span>
</code></pre>
</div>

<p><a href="graph/d.svg"><img src="graph/d.svg" alt="debug graph" height="150px" /></a></p>

<p>Similar to the “or” case above, you can use an “and” logical operation instead.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">org.scalawag.timber.api.level.Level._</span>
<span class="k">import</span> <span class="nn">org.scalawag.timber.backend.dispatcher.configuration.dsl._</span>

<span class="o">(</span> <span class="o">(</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="nc">ERROR</span> <span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">(</span> <span class="n">loggingClass</span> <span class="n">startsWith</span> <span class="s">"org.scalawag.timber"</span> <span class="o">)</span> <span class="o">)</span> <span class="o">~&gt;</span> <span class="n">stderr</span>
</code></pre>
</div>

<p><a href="graph/e.svg"><img src="graph/e.svg" alt="debug graph" height="150px" /></a></p>

<p>Some patterns are common enough that they have a shortcuts.  When you want to add a bunch of edges in parallel, use the <code class="highlighter-rouge">fanout</code> function.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">org.scalawag.timber.api.level.Level._</span>
<span class="k">import</span> <span class="nn">org.scalawag.timber.backend.dispatcher.configuration.dsl._</span>

<span class="n">fanout</span> <span class="o">(</span>
  <span class="n">level</span> <span class="o">&gt;=</span> <span class="nc">ERROR</span><span class="o">,</span>
  <span class="o">(</span> <span class="n">loggingClass</span> <span class="n">startsWith</span> <span class="s">"org.scalawag.timber"</span> <span class="o">)</span> <span class="n">and</span> <span class="o">(</span> <span class="n">level</span> <span class="o">&gt;</span> <span class="nc">DEBUG</span> <span class="o">)</span>
<span class="o">)</span> <span class="o">~&gt;</span> <span class="n">stderr</span>
</code></pre>
</div>

<p><a href="graph/f.svg"><img src="graph/f.svg" alt="debug graph" height="150px" /></a></p>

<p>After a <code class="highlighter-rouge">fanout</code>, you can add an edge and it will be added to the last vertex of each subgraph listed in the fanout.</p>

<p>If you want to create a structure where exactly one of a set of conditions determines the accepted path, use the <code class="highlighter-rouge">choose</code> function.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">org.scalawag.timber.api.level.Level._</span>
<span class="k">import</span> <span class="nn">org.scalawag.timber.backend.receiver._</span>
<span class="k">import</span> <span class="nn">org.scalawag.timber.backend.dispatcher.configuration.dsl._</span>

<span class="k">val</span> <span class="n">critical</span><span class="k">:</span> <span class="kt">Receiver</span> <span class="o">=</span> <span class="kc">null</span>
<span class="k">val</span> <span class="n">logfile</span><span class="k">:</span> <span class="kt">Receiver</span> <span class="o">=</span> <span class="kc">null</span>
<span class="k">val</span> <span class="n">trace</span><span class="k">:</span> <span class="kt">Receiver</span> <span class="o">=</span> <span class="kc">null</span>

<span class="n">choose</span> <span class="o">(</span>
  <span class="n">when</span><span class="o">(</span> <span class="n">level</span> <span class="o">&gt;</span> <span class="nc">ERROR</span> <span class="o">)</span> <span class="o">~&gt;</span> <span class="n">critical</span><span class="o">,</span>
  <span class="n">when</span><span class="o">(</span> <span class="n">level</span> <span class="o">&gt;</span> <span class="nc">TRACE</span> <span class="o">)</span> <span class="o">~&gt;</span> <span class="n">logfile</span><span class="o">,</span>
  <span class="n">otherwise</span> <span class="o">~&gt;</span> <span class="n">trace</span>
<span class="o">)</span>
</code></pre>
</div>

<p><a href="graph/g.svg"><img src="graph/g.svg" alt="debug graph" height="150px" /></a></p>

<p>You’d obviously want to create real receivers here instead of just using null. :)</p>

<p>You can fan-in after a <code class="highlighter-rouge">choose</code> just like <code class="highlighter-rouge">fanout</code>.  This will add an edge to each subgraph resulting from the choose.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">org.scalawag.timber.api.level.Level._</span>
<span class="k">import</span> <span class="nn">org.scalawag.timber.backend.dispatcher.configuration.dsl._</span>

<span class="n">choose</span> <span class="o">(</span>
  <span class="n">when</span><span class="o">(</span> <span class="n">loggingClass</span> <span class="n">startsWith</span> <span class="s">"org.scalawag.timber"</span> <span class="o">)</span> <span class="o">~&gt;</span> <span class="kc">true</span><span class="o">,</span>
  <span class="n">when</span><span class="o">(</span> <span class="n">loggingClass</span> <span class="n">startsWith</span> <span class="s">"org.scalawag"</span> <span class="o">)</span> <span class="o">~&gt;</span> <span class="o">(</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="nc">INFO</span> <span class="o">),</span>
  <span class="n">otherwise</span> <span class="o">~&gt;</span> <span class="o">(</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="nc">WARN</span> <span class="o">)</span>
<span class="o">)</span> <span class="o">~&gt;</span> <span class="n">stderr</span>
</code></pre>
</div>

<p><a href="graph/h.svg"><img src="graph/h.svg" alt="debug graph" height="150px" /></a></p>

<p>This also illustrates the use of a Boolean as a condition.  Above, we created a similar vertex but we have to use the <code class="highlighter-rouge">Condition(Boolean)</code> factory method.  That’s because, in that case, the compiler couldn’t have known that we wanted a vertex instead of a Boolean.  In this case, the compiler knows that <code class="highlighter-rouge">~&gt;</code> requires a Boolean, so it implicitly converts it for us.</p>

<p>Of course, your graph may not have anything to do with entry levels and your receivers may not all be writing to log files.  This graph writes everything to stderr and send any entry tagged with <code class="highlighter-rouge">Alert</code> to the <code class="highlighter-rouge">alerter</code> receiver as well.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">org.scalawag.timber.api.Tag</span>
<span class="k">import</span> <span class="nn">org.scalawag.timber.backend.receiver._</span>
<span class="k">import</span> <span class="nn">org.scalawag.timber.backend.dispatcher.configuration.dsl._</span>

<span class="k">val</span> <span class="n">alerter</span><span class="k">:</span> <span class="kt">Receiver</span> <span class="o">=</span> <span class="kc">null</span>

<span class="k">object</span> <span class="nc">Alert</span> <span class="k">extends</span> <span class="nc">Tag</span>

<span class="n">fanout</span> <span class="o">(</span>
  <span class="n">tagged</span><span class="o">(</span><span class="nc">Alert</span><span class="o">)</span> <span class="o">~&gt;</span> <span class="n">alerter</span><span class="o">,</span>
  <span class="n">stderr</span>
<span class="o">)</span>
</code></pre>
</div>

<p><a href="graph/i.svg"><img src="graph/i.svg" alt="debug graph" height="150px" /></a></p>

<h2 id="details">Details</h2>

<h3 id="subgraphs">Subgraphs</h3>

<p>Subgraphs are the main building blocks of timber configuration graphs.  A subgraph has exactly one root and one or
more leaves.  Subgraphs define the <code class="highlighter-rouge">~&gt;</code> edge-creation operator.  When you use this operator, it adds an edge from
<em>all</em> of the leaves on the left-hand subgraph to the root on the right-hand subgraph.  As you build up your graph,
you’ll create many subgraphs.  It’s not something you really notice if all goes well.</p>

<p>There are implicit conversions from receiver to subgraph and from condition to subgraph.  As long as you’re trying
to use the <code class="highlighter-rouge">~&gt;</code> operator, conversions will be done for you.  There are some situations where you need to be aware
of the conversions so that you don’t run into any gotchas.</p>

<h3 id="conditions">Conditions</h3>

<p>Condition vertices are created when you put a condition on either side of an edge using the <code class="highlighter-rouge">~&gt;</code> operator.  For a
full list of all the conditions that are built-in, see the <a href="Conditions">Conditions</a> page.  You can also create your
own condition if none of the built-ins work for you.</p>

<h3 id="receivers">Receivers</h3>

<p>Receiver vertices are created when you create an edge to a receiver.  There’s not really much to say about them
other than that it doesn’t matter if a Receiver is contained in many vertices.  Timber should still do the right
thing because it will recognize that the receiver has been added to the graph multiple times and treat them as
the same vertex when it comes time to route entries.</p>

<h2 id="gotchas">Gotchas</h2>

<p>When you are taking advantage of the implicit conversions, some strange things may happen.  What does the
following configuration do?</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">org.scalawag.timber.api.level.Level._</span>
<span class="k">import</span> <span class="nn">org.scalawag.timber.backend.dispatcher.configuration.dsl._</span>

<span class="k">val</span> <span class="n">cfg</span> <span class="k">=</span> <span class="nc">Configuration</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">in</span> <span class="k">=</span> <span class="kc">true</span>
  <span class="n">in</span> <span class="o">~&gt;</span> <span class="o">(</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="nc">ERROR</span> <span class="o">)</span> <span class="o">~&gt;</span> <span class="n">stderr</span>
  <span class="n">in</span> <span class="o">~&gt;</span> <span class="o">(</span> <span class="n">loggingClass</span> <span class="n">startsWith</span> <span class="s">"org.scalawag.timber"</span> <span class="o">)</span> <span class="o">~&gt;</span> <span class="n">stderr</span>
<span class="o">}</span>
</code></pre>
</div>

<p>If you think it creates a branching structure, you’re wrong.  Since the val <code class="highlighter-rouge">in</code> is type <code class="highlighter-rouge">Boolean</code>, every time it
appears in an edge creation, a new vertex is created.  So, while it may look like those last two lines are adding
to edges to the same vertex, they’re not.  They’re building two distinct subgraphs.  Well, they share <code class="highlighter-rouge">stderr</code> at
the end, but otherwise, they’re distinct.  What’s worse is that the Configuration will take the value of the thunk
(a subgraph representing the last line) and use its root for its own DAG root.  The end result is that the
penultimate line is completely ignored!</p>

<p>A valid way to write this is in the first example above where <code class="highlighter-rouge">in</code> is forced to be a subgraph with a call to
<code class="highlighter-rouge">Condition(Boolean)</code>.  Another way would be to use <code class="highlighter-rouge">fanout</code>.  Then, you don’t need <code class="highlighter-rouge">in</code> in the first place.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">org.scalawag.timber.api.level.Level._</span>
<span class="k">import</span> <span class="nn">org.scalawag.timber.backend.dispatcher.configuration.dsl._</span>

<span class="k">val</span> <span class="n">cfg</span> <span class="k">=</span> <span class="nc">Configuration</span> <span class="o">{</span>
  <span class="n">fanout</span> <span class="o">(</span>
    <span class="o">(</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="nc">ERROR</span> <span class="o">),</span>
    <span class="o">(</span> <span class="n">loggingClass</span> <span class="n">startsWith</span> <span class="s">"org.scalawag.timber"</span> <span class="o">)</span>
  <span class="o">)</span> <span class="o">~&gt;</span> <span class="n">stderr</span>
<span class="o">}</span>
</code></pre>
</div>

<h2 id="mutability">Mutability</h2>

<p>The graph that the DSL builds is mutable due to its builder-style interface.  You can always go back and add new
edges out of an existing vertex to create more paths.  As a matter of fact, it’s impossible to create two edges out
of a single vertex with the <code class="highlighter-rouge">~&gt;</code> operator at the same time.  You have to add one at a time.  This may seem to be
incongruous with the fact that dispatchers require immutable DAGs for their configuration.</p>

<p>The trick is that timber can build an immutable version of a mutable DAG on demand.  It normally does this behind
the scenes (with implicit conversions) so that you don’t have to be aware of the distinction but it’s good to
understand when you have obscure error messages.</p>

<p>The conversion from a mutable DAG to an immutable DAG is normally done when you pass the root vertex into a
<code class="highlighter-rouge">Configuration</code> constructor.  Any vertex reachable from the root vertex is included in the immutable DAG.  Other
vertices are excluded.</p>

<h2 id="debugging">Debugging</h2>

<p>If you’re having trouble figuring out why your configuration DAG is doing what it’s doing, it may be beneficial
to generate a visual representation.  This is what the <code class="highlighter-rouge">DotDumper</code> class does.  It can create a dump of a
<code class="highlighter-rouge">Configuration</code> as a <code class="highlighter-rouge">.dot</code> file which can then be rendered into several formats using
<a href="http://www.graphviz.org/">graphviz</a>.</p>

<p>The diagrams of the example graphs above were generated using <code class="highlighter-rouge">DotDumper</code> and <code class="highlighter-rouge">dot</code> from the graphviz suite.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>dot -T svg graph.dot &gt; graph.svg
</code></pre>
</div>

<h2 id="best-practices">Best Practices</h2>

<p>Due to the way that entry formatters work, <code class="highlighter-rouge">stderr</code> and <code class="highlighter-rouge">stdout</code> are <em>functions</em> in the DSL. This means that every
time you include them in your DSL, a new receiver is created. Despite the fact that each of these Receivers will
function similarly and will output to the same location, it’s a good idea not to create multiple. Having a single
receiver for each destination will ensure that there’s no contention for the underlying resource.  Multiple
receivers (even with concurrency control) can actually write to the same underlying stream simultaneously since they
are ignorant of each others’ presence.</p>

<p>This creates two unnamed receivers that both eventually write to the same file descriptor.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nc">IN</span> <span class="o">::</span> <span class="o">(</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="mi">8</span> <span class="o">)</span> <span class="o">::</span> <span class="n">stderr</span>
<span class="nc">IN</span> <span class="o">::</span> <span class="o">(</span> <span class="n">level</span> <span class="o">&lt;=</span> <span class="mi">4</span> <span class="o">)</span> <span class="o">::</span> <span class="n">stderr</span>
</code></pre>
</div>

<p>This actually does what you want it to do and makes sure that any locking that’s happening is done in a single place
for the <code class="highlighter-rouge">stderr</code> file descriptor.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">val</span> <span class="n">console</span> <span class="k">=</span> <span class="n">stderr</span>
<span class="nc">IN</span> <span class="o">::</span> <span class="o">(</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="mi">8</span> <span class="o">)</span> <span class="o">::</span> <span class="n">console</span>
<span class="nc">IN</span> <span class="o">::</span> <span class="o">(</span> <span class="n">level</span> <span class="o">&lt;=</span> <span class="mi">4</span> <span class="o">)</span> <span class="o">::</span> <span class="n">console</span>
</code></pre>
</div>

<p>In general, it’s best just to create all your receivers near the beginning of your configuration and give them
identifiers.  Then, you can use them as many times as is necessary without having to think too hard about it.
You also need to make sure that if they’re resource-based receivers (files, etc.) that you close them when you’re
done with them.  Putting them all in one place will make it easy to identify them and take care of the closing.
Of course, you don’t have to do this if you understand what you’re doing and only have one reference to each receiver.</p>

<h2 id="miscellanea">Miscellanea</h2>

<ul>
  <li>
    <p>Note that it <em>is</em> possible to create a path that doesn’t terminate in a receiver but timber will simply ignore it.</p>
  </li>
  <li>
    <p>The root of a configuration is not special in any way before it’s given to the configuration.  It only becomes
special once you’ve given it to the dispatcher and, even then, it’s only special to that dispatcher.  You could
have a single DAG and pass different vertices within it to different dispatchers as their root.  I can’t think of
a reason why you would do this but you can.</p>
  </li>
  <li>
    <p>By convention, the input to all DAGs in the examples is an accept-all condition vertex named <code class="highlighter-rouge">IN</code>.  When configuring
a dispatcher, it needs to be given the root vertex into the DAG.  There’s no reason that it <em>has</em> to be a
valve or has to have this name.  It simply makes it easier to add paths later and it’s easy to recognize.</p>
  </li>
</ul>

<h2 id="next-steps">Next Steps</h2>

<ul>
  <li>Learn about the [conditions](Conditions] that you can use in your DAG.</li>
  <li>Learn how to create more advanced <a href="Receivers">receivers</a>.</li>
</ul>

</div>

<a class="help" href="https://github.com/scalawag/timber/edit/develop/src/jekyll/backend/03-ConfigurationDSL.md">
  Help improve this page.
</a>

    </div>

  </body>
</html>
