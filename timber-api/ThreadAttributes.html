<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Thread Attributes &middot; timber
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/timber/public/css/poole.css">
  <link rel="stylesheet" href="/timber/public/css/syntax.css">
  <link rel="stylesheet" href="/timber/public/css/hyde.css">
  <link rel="stylesheet" href="/timber/public/css/custom.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <!-- <link rel="shortcut icon" href="/timberpublic/favicon.ico"> -->

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <div class="sidebar">
  <div class="container">
    <div class="sidebar-about">
      <h1>
        timber
      </h1>
      <p class="lead"></p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/timber">Home</a>

      

      
      

      
        
        
          
            
              
                <a class="sidebar-nav-item" href="/timber/Concepts">Concepts</a>
              
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
            
          
        
          
        
        <hr/>
      
        timber-api
        
          
            
          
        
          
            
              
                <a class="sidebar-nav-item" href="/timber/timber-api/GettingStarted">Getting Started</a>
              
            
          
        
          
            
          
        
          
            
          
        
          
            
              
                <a class="sidebar-nav-item" href="/timber/timber-api/Loggers">Loggers</a>
              
            
          
        
          
            
          
        
          
            
              
                <a class="sidebar-nav-item" href="/timber/timber-api/Messages">Messages</a>
              
            
          
        
          
            
          
        
          
            
              
                <a class="sidebar-nav-item" href="/timber/timber-api/Levels">Levels</a>
              
            
          
        
          
            
          
        
          
            
              
                <a class="sidebar-nav-item active" href="/timber/timber-api/ThreadAttributes">Thread Attributes</a>
              
            
          
        
          
            
          
        
          
            
          
        
          
            
              
                <a class="sidebar-nav-item" href="/timber/timber-api/BestPractices">Best Practices</a>
              
            
          
        
          
            
              
                <a class="sidebar-nav-item" href="/timber/timber-api/AdvancedUsage">Advanced Usage</a>
              
            
          
        
          
        
        <hr/>
      
        timber-backend
        
          
            
          
        
          
            
          
        
          
            
              
                <a class="sidebar-nav-item" href="/timber/timber-backend/GettingStarted">Getting Started</a>
              
            
          
        
          
            
              
                <a class="sidebar-nav-item" href="/timber/timber-backend/Dispatchers">Dispatchers</a>
              
            
          
        
          
            
          
        
          
            
              
                <a class="sidebar-nav-item" href="/timber/timber-backend/ConfigurationDSL">Configuration DSL</a>
              
            
          
        
          
            
          
        
          
            
              
                <a class="sidebar-nav-item" href="/timber/timber-backend/Conditions">Conditions</a>
              
            
          
        
          
            
          
        
          
            
              
                <a class="sidebar-nav-item" href="/timber/timber-backend/Entries">Entries</a>
              
            
          
        
          
            
          
        
          
            
              
                <a class="sidebar-nav-item" href="/timber/timber-backend/Formatters">Formatters</a>
              
            
          
        
          
            
              
                <a class="sidebar-nav-item" href="/timber/timber-backend/Receivers">Receivers</a>
              
            
          
        
          
            
          
        
          
            
          
        
          
        
        <hr/>
      

      <a class="sidebar-nav-item" href="https://github.com/scalawag/timber">View on GitHub</a>
<!--      <a class="sidebar-nav-item" href="https://github.com/scalawag/timber/archive/v0.6.0-SNAPSHOT.zip">Download</a> -->
      <span class="sidebar-nav-item">Currently v0.6.0-SNAPSHOT</span>
    </nav>

    <p>&copy; 2016</p>
  </div>
</div>


    <div class="content container">
      <div class="page">
  <h1 class="page-title">Thread Attributes</h1>
  <p>Sometimes, you want to associate your entries with dynamic context, based on the thread’s stack at the time the
logging call is made.  This is what timber’s thread attributes are for.  Contrast this to the static context
provided by <a href="Loggers#slc">logger attributes</a>. Thread attributes are essentially maps of stacks of strings which
are automatically copied by a logger to its entries when it creates them.</p>

<p>The <code class="highlighter-rouge">ThreadAttributes</code> object provides an easy way to manage a thread’s attributes.  As indicated before, each
attribute name maps to a stack of strings.  This is because, for dynamic context, you often want to set an attribute
for the duration of a block of code and then return it to its previous value when the block is complete.  This could
be to identify the subsystem within which the logging call takes place, for example.</p>

<p>For simple cases, use the <code class="highlighter-rouge">during()</code> method which both pushes a new value onto the stack and pops it once its
thunk is complete.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="nc">ThreadAttributes</span><span class="o">.</span><span class="n">during</span><span class="o">(</span><span class="s">"subsystem"</span><span class="o">,</span><span class="s">"model"</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="o">(</span><span class="s">"msg1"</span><span class="o">)</span>
  <span class="nc">ThreadAttributes</span><span class="o">.</span><span class="n">during</span><span class="o">(</span><span class="s">"subsystem"</span><span class="o">,</span><span class="s">"db"</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="o">(</span><span class="s">"msg2"</span><span class="o">)</span>
  <span class="o">}</span>
  <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="o">(</span><span class="s">"msg3"</span><span class="o">)</span>
<span class="o">}</span>
</code></pre>
</div>

<p>If you need to separate the push and pop (across method boundaries, for example), you can use the <code class="highlighter-rouge">push()</code> and <code class="highlighter-rouge">pop()</code>
methods.  The <code class="highlighter-rouge">pop()</code> method requires that you specify the values that you expect to be at the top of the stack to
help prevent errors in push/pop asymmetry.  Trying to pop the wrong values from the stacks will result in a runtime
exception being thrown.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="n">enter</span><span class="o">()</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
  <span class="nc">ThreadAttributes</span><span class="o">.</span><span class="n">push</span><span class="o">(</span><span class="s">"subsystem"</span><span class="o">,</span><span class="s">"db"</span><span class="o">)</span>
<span class="o">}</span>

<span class="k">def</span> <span class="n">exit</span><span class="o">()</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
  <span class="nc">ThreadAttributes</span><span class="o">.</span><span class="n">pop</span><span class="o">(</span><span class="s">"subsystem"</span><span class="o">,</span><span class="s">"db"</span><span class="o">)</span>
<span class="o">}</span>

<span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="o">(</span><span class="s">"msg1"</span><span class="o">)</span>
<span class="n">enter</span><span class="o">()</span>
<span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="o">(</span><span class="s">"msg2"</span><span class="o">)</span>
<span class="n">exit</span><span class="o">()</span>
<span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="o">(</span><span class="s">"msg3"</span><span class="o">)</span>
</code></pre>
</div>

<p>Example use cases:</p>

<ul>
  <li>Storing the client IP address of a web request so that it can be logged (using a thread-centric web library).</li>
  <li>Storing the role of an authenticated user on the thread so that admin actions can be logged at a different level.</li>
</ul>

</div>

<a class="help" href="https://github.com/scalawag/timber/edit/develop/src/jekyll/timber-api/05-ThreadAttributes.md">
  Help improve this page.
</a>

    </div>

  </body>
</html>
